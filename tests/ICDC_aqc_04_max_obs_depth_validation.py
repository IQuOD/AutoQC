import qctests.ICDC_aqc_04_max_obs_depth as ICDC_mol

import util.testingProfile
import numpy as np

##### ICDC crude range check.
##### --------------------------------------------------

def test_ICDC_max_obs_level():
    '''Make sure code processes data supplied by Viktor Gouretski
       correctly.
    '''

    lines = data.splitlines()
    for i, line in enumerate(lines):
        if line[0:2] == 'HH':
            header  = line.split()
            dataset = header[-1][-3:]
            probe_type = probe_types[dataset]
            nlevels = int(header[-1][:-3])
            
            depths  = []
            qctruth = []
            for j in range(nlevels):
                d = lines[i + j + 1].split()
                depths.append(float(d[0]))
                qctruth.append(int(d[1]) > 0)
            
            p  = util.testingProfile.fakeProfile(depths, depths, probe_type=probe_type)
            p.primary_header['Country code'] = 'JP'
            qc = ICDC_mol.test(p)
       
            assert np.array_equal(qc, qctruth), 'Failed profile with header ' + line

probe_types = {'OSD': 7, 'CTD': 4, 'PFL': 9, 'APB': 13, 'MBT': 1, 'XBT': 2}

# Data provided by Viktor Gouretski, ICDC, University of Hamburg.
data = '''
HH     557380   -23.183  -174.668 1968 12 18     35OSD
    0.0 0
    9.0 0
   27.0 0
   45.0 0
   67.0 0
   90.0 0
  135.0 0
  180.0 0
  270.0 0
  360.0 0
  450.0 0
  541.0 0
  632.0 0
  724.0 0
  912.0 0
 1061.0 0
 1105.0 0
 1333.0 0
 1795.0 0
 2262.0 0
 2731.0 0
 3204.0 0
 3676.0 0
 4151.0 0
 4626.0 0
 5103.0 0
 6043.0 0
 6523.0 0
 7005.0 0
 7486.0 0
 7968.0 0
 8448.0 0
 8928.0 0
 9410.0 1
 9890.0 1
HH    6832138    58.470   -12.840 1978  7 17    771CTD
    5.8 0
    6.9 0
    7.3 0
    8.0 0
    9.1 0
    9.5 0
   10.2 0
   11.3 0
   12.5 0
   13.6 0
   14.3 0
   15.1 0
   16.1 0
   17.6 0
   18.3 0
   19.0 0
   19.8 0
   22.7 0
   23.9 0
   24.6 0
   26.0 0
   26.8 0
   27.1 0
   28.6 0
   29.7 0
   30.4 0
   31.9 0
   33.0 0
   33.4 0
   33.8 0
   34.9 0
   35.6 0
   37.0 0
   38.1 0
   39.6 0
   40.0 0
   40.7 0
   42.2 0
   44.1 0
   45.6 0
   45.9 0
   46.7 0
   47.0 0
   48.1 0
   48.4 0
   49.2 0
   49.5 0
   51.0 0
   52.1 0
   53.3 0
   54.0 0
   54.8 0
   56.2 0
   57.7 0
   59.1 0
   60.2 0
   61.0 0
   61.7 0
   62.4 0
   64.3 0
   65.4 0
   65.8 0
   66.5 0
   66.9 0
   67.7 0
   67.9 0
   69.0 0
   69.4 0
   71.3 0
   72.0 0
   73.1 0
   74.2 0
   75.4 0
   76.1 0
   77.2 0
   78.3 0
   79.4 0
   80.5 0
   82.0 0
   82.7 0
   83.8 0
   84.6 0
   86.1 0
   86.8 0
   87.2 0
   87.5 0
   88.7 0
   90.1 0
   91.5 0
   92.7 0
   93.4 0
   93.8 0
   94.9 0
   95.3 0
   95.6 0
   96.0 0
   97.1 0
   97.9 0
   99.6 0
  100.4 0
  101.5 0
  101.9 0
  103.4 0
  105.2 0
  106.0 0
  107.1 0
  107.5 0
  108.8 0
  109.6 0
  110.7 0
  111.5 0
  111.8 0
  113.3 0
  116.3 0
  116.7 0
  117.8 0
  118.2 0
  118.4 0
  118.8 0
  119.2 0
  119.9 0
  131.4 0
  132.9 0
  134.0 0
  136.6 0
  138.4 0
  140.2 0
  141.4 0
  143.2 0
  146.2 0
  151.3 0
  154.0 0
  155.5 0
  156.6 0
  158.4 0
  160.6 0
  162.1 0
  163.2 0
  165.5 0
  166.9 0
  168.4 0
  170.2 0
  172.4 0
  174.3 0
  176.2 0
  177.3 0
  178.4 0
  180.6 0
  182.4 0
  183.9 0
  189.1 0
  190.2 0
  192.1 0
  194.3 0
  195.8 0
  197.6 0
  198.3 0
  201.0 0
  205.8 0
  207.3 0
  209.5 0
  210.6 0
  212.5 0
  214.0 0
  215.1 0
  217.3 0
  220.6 0
  222.1 0
  225.5 0
  226.6 0
  231.8 0
  234.4 0
  236.2 0
  236.9 0
  238.4 0
  240.3 0
  242.2 0
  243.7 0
  245.1 0
  246.6 0
  248.1 0
  250.7 0
  252.6 0
  254.1 0
  255.9 0
  258.1 0
  261.1 0
  263.4 0
  265.5 0
  267.4 0
  271.5 0
  273.0 0
  274.1 0
  276.3 0
  278.2 0
  280.1 0
  282.3 0
  283.4 0
  284.9 0
  287.5 0
  289.0 0
  290.9 0
  292.3 0
  294.2 0
  295.7 0
  298.3 0
  300.5 0
  301.6 0
  304.6 0
  306.9 0
  312.1 0
  313.2 0
  315.1 0
  317.0 0
  319.1 0
  321.0 0
  322.1 0
  324.4 0
  326.7 0
  327.4 0
  329.9 0
  333.7 0
  335.2 0
  336.7 0
  339.3 0
  341.2 0
  343.0 0
  344.9 0
  346.4 0
  348.2 0
  352.8 0
  354.6 0
  356.8 0
  357.9 0
  360.2 0
  363.2 0
  364.6 0
  366.5 0
  368.0 0
  369.9 0
  371.8 0
  374.0 0
  375.5 0
  377.0 0
  380.4 0
  382.3 0
  384.1 0
  386.4 0
  388.6 0
  390.1 0
  395.7 0
  398.4 0
  401.3 0
  402.4 0
  404.7 0
  406.6 0
  408.1 0
  409.5 0
  411.8 0
  413.7 0
  414.8 0
  417.8 0
  419.3 0
  420.8 0
  423.1 0
  426.0 0
  426.5 0
  427.9 0
  429.4 0
  430.9 0
  436.1 0
  438.8 0
  439.5 0
  442.2 0
  444.4 0
  445.9 0
  448.5 0
  451.6 0
  453.4 0
  454.9 0
  456.4 0
  459.4 0
  461.6 0
  463.5 0
  465.4 0
  466.9 0
  468.8 0
  470.6 0
  472.5 0
  474.8 0
  479.3 0
  481.5 0
  483.1 0
  485.7 0
  486.8 0
  488.3 0
  490.2 0
  494.4 0
  496.5 0
  497.3 0
  499.6 0
  501.9 0
  503.7 0
  504.8 0
  506.7 0
  508.2 0
  511.3 0
  513.1 0
  515.0 0
  516.9 0
  521.7 0
  523.6 0
  524.4 0
  526.7 0
  528.2 0
  530.8 0
  532.3 0
  534.6 0
  536.1 0
  537.9 0
  539.1 0
  540.6 0
  542.1 0
  543.7 0
  546.6 0
  547.7 0
  550.8 0
  552.7 0
  554.1 0
  555.7 0
  561.0 0
  563.2 0
  564.3 0
  566.6 0
  568.5 0
  570.3 0
  573.8 0
  576.1 0
  577.2 0
  580.2 0
  581.3 0
  583.2 0
  585.5 0
  588.1 0
  589.6 0
  591.2 0
  593.1 0
  596.4 0
  597.9 0
  601.0 0
  606.6 0
  607.8 0
  610.7 0
  612.7 0
  615.0 0
  616.1 0
  618.0 0
  620.6 0
  622.9 0
  624.8 0
  626.0 0
  627.4 0
  629.7 0
  631.6 0
  633.9 0
  635.7 0
  638.0 0
  639.9 0
  641.8 0
  643.3 0
  648.6 0
  650.5 0
  652.0 0
  654.7 0
  656.6 0
  658.0 0
  659.9 0
  662.2 0
  663.4 0
  666.0 0
  667.9 0
  669.8 0
  671.7 0
  673.7 0
  675.5 0
  677.8 0
  680.9 0
  683.1 0
  685.7 0
  687.3 0
  691.8 0
  693.3 0
  694.1 0
  695.2 0
  696.0 0
  707.0 0
  709.7 0
  712.0 0
  714.2 0
  717.6 0
  719.2 0
  720.7 0
  721.4 0
  722.9 0
  724.9 0
  726.0 0
  727.5 0
  729.7 0
  731.3 0
  734.0 0
  735.9 0
  739.3 0
  742.0 0
  744.3 0
  746.9 0
  749.2 0
  751.1 0
  753.3 0
  755.7 0
  759.8 0
  762.1 0
  764.8 0
  766.3 0
  768.6 0
  770.9 0
  772.8 0
  774.7 0
  776.9 0
  778.9 0
  785.3 0
  787.3 0
  789.9 0
  791.8 0
  793.3 0
  796.4 0
  798.7 0
  801.4 0
  803.3 0
  804.5 0
  807.5 0
  809.0 0
  810.9 0
  815.1 0
  817.0 0
  819.7 0
  821.6 0
  822.7 0
  825.8 0
  828.4 0
  832.7 0
  833.8 0
  834.9 0
  835.3 0
  836.5 0
  838.0 0
  839.2 0
  840.7 0
  842.5 0
  844.1 0
  847.6 0
  849.8 0
  852.1 0
  854.8 0
  856.8 0
  860.2 0
  862.1 0
  864.0 0
  865.9 0
  867.8 0
  873.1 0
  875.9 0
  877.0 0
  878.9 0
  880.4 0
  883.1 0
  885.5 0
  886.9 0
  888.9 0
  890.0 0
  892.0 0
  895.8 0
  897.7 0
  898.9 0
  901.5 0
  903.4 0
  905.4 0
  907.3 0
  909.1 0
  911.1 0
  916.8 0
  918.8 0
  921.1 0
  924.1 0
  927.2 0
  929.2 0
  931.8 0
  934.1 0
  936.0 0
  938.7 0
  939.9 0
  941.4 0
  943.0 0
  945.6 0
  948.3 0
  950.3 0
  952.5 0
  953.7 0
  956.0 0
  958.3 0
  962.9 0
  965.6 0
  966.7 0
  970.2 0
  972.1 0
  973.3 0
  976.8 0
  979.8 0
  981.3 0
  983.7 0
  986.0 0
  987.5 0
  990.2 0
  992.5 0
  995.6 0
  998.3 0
 1000.2 0
 1002.1 0
 1004.5 0
 1006.8 0
 1012.2 0
 1014.4 0
 1016.0 0
 1018.7 0
 1019.9 0
 1021.7 0
 1025.3 0
 1027.6 0
 1028.7 0
 1030.2 0
 1032.6 0
 1034.8 0
 1038.8 0
 1041.1 0
 1043.3 0
 1044.9 0
 1047.3 0
 1049.5 0
 1050.7 0
 1052.6 0
 1058.8 0
 1061.6 0
 1062.3 0
 1065.8 0
 1067.7 0
 1069.6 0
 1071.5 0
 1073.5 0
 1075.8 0
 1078.5 0
 1079.7 0
 1081.6 0
 1083.9 0
 1085.8 0
 1088.6 0
 1089.8 0
 1091.6 0
 1094.8 0
 1097.0 0
 1099.0 0
 1104.8 0
 1106.3 0
 1109.4 0
 1112.1 0
 1114.1 0
 1115.7 0
 1118.7 0
 1120.7 0
 1122.2 0
 1126.9 0
 1130.3 0
 1133.1 0
 1133.4 0
 1135.8 0
 1138.8 0
 1141.2 0
 1142.8 0
 1145.4 0
 1147.4 0
 1150.1 0
 1155.6 0
 1157.0 0
 1160.2 0
 1162.5 0
 1164.8 0
 1166.8 0
 1168.4 0
 1168.7 0
 1170.2 0
 1172.6 0
 1174.6 0
 1176.1 0
 1178.4 0
 1180.0 0
 1182.7 0
 1184.2 0
 1186.2 0
 1188.9 0
 1190.8 0
 1192.8 0
 1199.0 0
 1201.4 0
 1203.2 0
 1205.6 0
 1207.6 0
 1210.2 0
 1212.6 0
 1214.2 0
 1216.4 0
 1218.8 0
 1221.6 0
 1223.5 0
 1225.0 0
 1228.2 0
 1230.1 0
 1232.1 0
 1234.4 0
 1236.7 0
 1239.1 0
 1241.0 0
 1247.3 0
 1249.1 0
 1251.9 0
 1253.9 0
 1255.8 0
 1258.1 0
 1260.1 0
 1262.0 0
 1264.4 0
 1267.1 0
 1268.6 0
 1271.4 0
 1273.4 0
 1274.9 0
 1278.4 0
 1280.3 0
 1283.1 0
 1285.9 0
 1286.9 0
 1289.3 0
 1294.4 0
 1297.2 0
 1299.8 0
 1302.2 0
 1305.4 0
 1307.7 0
 1309.6 0
 1311.2 0
 1313.5 0
 1316.3 0
 1319.0 0
 1320.2 0
 1322.5 0
 1324.4 0
 1326.8 0
 1328.4 0
 1331.5 0
 1334.2 0
 1336.2 0
 1338.5 0
 1344.4 0
 1346.8 0
 1349.2 0
 1350.6 0
 1352.6 0
 1355.0 0
 1356.9 0
 1359.7 0
 1362.1 0
 1364.0 0
 1365.6 0
 1368.0 0
 1371.0 0
 1373.0 0
 1375.3 0
 1378.1 0
 1380.1 0
 1381.2 0
 1383.6 0
 1386.0 0
 1393.7 0
 1396.9 0
 1398.9 0
 1402.0 0
 1404.8 0
 1407.1 0
 1409.5 0
 1410.7 0
 1413.4 0
 1416.1 0
 1418.5 0
 1419.2 0
 1422.0 0
 1424.7 0
 1426.7 0
 1429.1 0
 1430.6 0
 1433.8 0
 1435.8 0
 1438.1 0
 1443.6 0
 1445.6 0
 1448.7 0
 1449.5 0
 1452.3 0
 1453.9 0
 1456.2 0
 1458.6 0
 1460.9 0
 1462.9 0
 1465.7 0
 1467.6 0
 1470.0 0
 1472.0 0
 1474.7 0
 1478.7 0
 1482.2 0
 1484.2 0
 1486.5 0
 1489.3 0
 1495.6 0
 1497.1 0
 1498.3 0
 1501.5 0
 1504.2 0
 1505.4 0
 1507.8 0
 1510.1 0
 1512.5 0
 1514.1 0
 1516.8 0
 1519.2 0
 1520.8 0
 1524.8 0
 1527.1 0
 1529.9 0
 1531.9 0
 1533.8 0
 1535.8 0
 1538.9 0
 1544.1 0
 1546.0 0
 1548.5 0
 1550.8 0
 1552.8 0
 1554.4 0
 1556.7 0
 1559.1 0
 1561.8 0
 1563.4 0
 1566.2 0
 1568.5 0
 1570.9 0
 1573.0 0
 1574.9 0
 1577.3 0
 1579.6 0
 1581.6 0
 1583.6 0
 1585.2 0
 1588.8 0
35730.8 1
HH    8562160   -12.646   116.215 1999 11  3     50PFL
    2.6 0
    6.0 0
   16.2 0
   25.9 0
   35.6 0
   45.3 0
   55.5 0
   65.8 0
   75.4 0
   85.1 0
   95.4 0
  114.9 0
  134.9 0
  154.8 0
  173.8 0
  194.2 0
  213.6 0
  234.1 0
  253.5 0
  274.2 0
  293.5 0
  313.8 0
  332.9 0
  353.0 0
  372.2 0
  391.8 0
  411.5 0
  432.7 0
  452.5 0
  472.0 0
  491.5 0
  551.7 0
  611.2 0
  670.5 0
  729.7 0
  788.7 0
  848.2 0
  908.3 0
  986.5 0
 1086.2 0
 1183.8 0
 1283.7 0
 1382.1 0
 1480.1 0
 1579.2 0
 1677.6 0
 1777.3 0
 1875.2 0
 1974.0 0
 2062.8 1
HH   10869261   -53.288    78.437 2004  3 11     18APB
    5.3 0
   62.4 0
   73.8 0
   79.6 0
  113.8 0
  193.9 0
  262.5 0
  268.2 0
  319.6 0
  399.5 0
  451.0 0
  508.0 0
  644.9 0
  650.6 0
  759.0 0
  798.9 0
 1112.0 0
 1254.2 1
HH    4377191    35.550    -0.400 1950  5 17      3MBT
    0.0 0
   20.0 0
  300.0 1
HH    3443567    44.730   -13.370 1969  9 21     33XBT
    0.0 0
   10.0 0
   20.0 0
   30.0 0
   50.0 0
   75.0 0
  100.0 0
  125.0 0
  150.0 0
  200.0 0
  250.0 0
  300.0 0
  350.0 0
  400.0 0
  450.0 0
  500.0 0
  550.0 0
  600.0 0
  650.0 0
  700.0 0
  750.0 0
  800.0 0
  850.0 0
  900.0 0
  950.0 0
 1000.0 0
 1100.0 0
 1200.0 0
 1300.0 0
 1400.0 0
 1500.0 0
 2000.0 1
 2500.0 1
'''

